<!doctype html>
<html lang="si">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>6 Square Tiles — WhatsApp Product Cutter (Grid Preview)</title>
<link href="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.css" rel="stylesheet"/>
<style>
:root{
    --bg:#0b1220;
    --panel:#0f1724;
    --text:#e6eef7;
    --muted:#9fb0c8;
    --accent:#2dd4bf
}
    
*{
    box-sizing:border-box
}
    
body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Ubuntu;
    background:var(--bg);
    color:var(--text);
    padding:0px
    height: 100vh;
    
}
    
/* 🔹 Video set as background */
  video.bg-video {
    position: fixed;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    object-fit: cover;
    transform: translate(-50%, -50%);
    z-index: -1; /* keep video behind content */
    filter: brightness(0.4);
    animation: zoom 20s infinite alternate;
  }

  @keyframes zoom {
    0%   { transform: translate(-50%, -50%) scale(1); }
    50%  { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }
    
/* =============================================================== */
    
  .background {
    position: relative;
    width: 100%;
    background: transparent;
    overflow: hidden;
    margin-top:56px;
    padding:12px;
}
    
  .bg-video {
    position: absolute;
    top: 50%;
    left: 50%;
    backround: yellow;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: translate(-50%, -50%);
    z-index: 1;
    filter: brightness(0.5);
    animation: zoom 20s infinite alternate;
  }

  @keyframes zoom {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }

    
   /* =========================== BOTTOM NAME TAG ================================= */
    .bottom-toolbar {
      position: fixed;       /* pin at bottom */
      bottom: 0;             /* bottom 0 */
      left: 0;               /* full width start */
      right: 0;              /* full width end */
      height: 30px;          /* small height */
      background: linear-gradient(180deg, yellow, red); /* gradient */
      color: black;
      display: flex;
      align-items: center;    /* vertical center */
      justify-content: center; /* horizontal center */
      font-weight: bold;
      font-size:px;
      z-index: 9999;          /* always on top */
      user-select: none;
    }
/* ====================================================== */
    
h1{
    font-size:14px;
    text-align:center;
    margin:0 0 10px
}
    
.top {
  display: flex;
  justify-content: center; /* horizontal center */
  align-items: center;     /* vertical center (if parent has height) */
  margin-top: 20px;        /* optional spacing */
}
    
input[type=file]{
    display:inline-block
}
    
.btn{
    background:#0f1724;
    border:1px solid #203040;
    color:var(--text);
    padding:8px 10px;
    border-radius:10px;
    cursor:pointer
}
    
.btn{
    background: linear-gradient(135deg, #ff0000, #0f2b3a);
    boder:1px solid #000000;
    color:var(--text);
    margin-left:5px;
    padding:8px 10px;
    border-radius:10px;
    cursor:pointer
}
    
/* ====================== Table styling ================================ */
  #details table {
    border-collapse: collapse;
    margin-top: 10px;
    margin-bottom: 20px;
    width: 90%;
    text-align: left;
    border: 0px solid transparent;
    border-image: linear-gradient(45deg, red, red) 1; /* gradient border */
    box-shadow: 0 0 15px rgba(255, 200, 0, 0.3); /* glowing effect */
    border-radius: 8px;
    overflow: hidden;
    background: #1e1e1e; /* dark table background */
      
/* Hide before animation */
    opacity: 0;
    transform: translateY(40px) scale(0.9) rotateX(25deg);
    filter: blur(6px);
  }
    
/* Animate in */
  #details table.show {
    animation: tableReveal 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }

  @keyframes tableReveal {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.4) rotateX(25deg);
      filter: blur(6px);
    }
    60% {
      opacity: 1;
      transform: translateY(5px) scale(1.02) rotateX(0deg);
      filter: blur(1px);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1) rotateX(0deg);
      filter: blur(0);
    }
  }

  #details th {
    background: linear-gradient(45deg, red, orange);
    color: #fff;
    padding: 12px;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #details td {
    padding: 10px 14px;
    border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 14px;
    color: #f5f5f5;
  }

  #details tr:nth-child(even) {
    background-color: rgba(255,255,255,0.05); /* subtle dark striping */
  }

  #details tr:hover {
    background-color: rgba(255, 200, 0, 0.1); /* hover highlight */
    transition: background 0.8s;
  }
/* ============================================================= */
    
.stage{
    width:100%;
    max-width:920px;
    background:#071018;
    border-radius:12px;
    padding:10px;
    border:1px solid #ff0000;
    margin-bottom:10px
}
    
img#preview{
    max-width:100%;
    display:block;
    max-height:100%;
}
    
.controls{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:8px
}
    
.tiles{
    display:grid;
    padding:20px;
    grid-template-columns:repeat(3,1fr);
    gap:4px;
    margin-top:10px
}
    
.tile{
    cursor: block;
    width :100%;
    hight :100%;
    background:transparent;
    border-radius:8px;
    overflow:hidden;
    padding:4px;
    display:flex;
    flex-direction:column;
    align-items:center
}
    
.tile img{
    width:100%;
    height:100%;
    border-radius:8px;
    border:0px solid #17323a;
    cursor:zoom-in;
    display:block;
    max-height:100%;
    object-fit:cover
}
    
.tile a{
    margin-top:6px
}
    
a.download-link{
    padding:6px 8px;
    background:#0e1b20;
    border-radius:8px;
    color:var(--text);
    text-decoration:none;
    border:1px solid #17323a;
    font-weight:600;
    display:inline-block
}
    
.note{
    color:var(--muted);
    font-size:13px;
    margin-top:6px
}
    
@media(max-width:800px){
    .tiles{
        grid-template-columns:repeat(2,1fr)
    } 
}
@media(max-width:420px){
    .tiles{
        grid-template-columns:repeat(1,1fr)
    } 
}

/* Modal */
#tilePreviewModal {
    display: none;
    position: fixed;
    z-index: 9999;
    background: rgba(0,0,0,0.3); backdrop-filter: blur(6px);
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    align-items: center;
    justify-content: center;
    overflow: auto;
    padding: 20px;
}

.preview-shell {
    width: 100%;
    max-width: 1100px;
    max-height: calc(100% - 80px);
    background: transparent;
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
}

.preview-top {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: center;
}

.preview-title {
    color: var(--text);
    font-weight: 700;
}

.preview-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.preview-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    align-items: stretch;
}

.preview-grid .tile {
    background: #071018;
    padding: 0px;
    border-radius: 10px;
    border: 0px solid #000000; /* 2px border added */
}

.preview-grid img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    max-height: 230px;
    border-radius: 8px;
}

.preview-single {
    display: none;
    align-items: center;
    justify-content: center;
    position: relative;
    flex: 1;
    min-height: 320px;
}

.preview-single img {
    max-width: none;
    max-height: none;
    will-change: transform;
    touch-action: none;
    cursor: grab;
    border-radius: 8px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
}

.hint {
    color: var(--muted);
    font-size: 13px;
    text-align: center;
    margin-top: 4px;
}

@media(max-width:900px) {
    .preview-grid img {
        max-height: 160px;
    }
}
/* ============================= DRAWER CSS DOCS ================================= */
/* Toolbar */
.toolbar {
  position: fixed;       /* 👈 pin at top */
  top: 0;                /* 👈 top 0 */
  left: 0;               /* 👈 full width start */
  right: 0;              /* 👈 full width end */
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #000000;
  color: white;
  padding: 0 16px;
  height: 56px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  z-index: 9999;         /* 👈 always on top */
}
    
.toolbar .menu, .toolbar .account {
    cursor:pointer;
    font-size:20px;
}
    
.toolbar .title {
    font-size:15px;
    font-weight:bold;
}
    
.menu {
  font-size: 24px;
  cursor: pointer;
  user-select: none;

  /* UI look */
  padding: 0px 0px;
  border-radius: 8px;
  transition: transform 0.2s ease, background-color 0.2s ease;
      outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* Focus / click highlight remove */
.menu:focus {
  outline: none;
}
.menu:focus-visible {
  outline: none;
}

/* Hover effect */
.menu:hover {
  background-color: rgba(255,255,255,0.1);
}

/* Click / active animation */
.menu:active {
  transform: scale(0.80);         /* small shrink */
  background-color: rgba(255,255,255,0.2);
}
   
.account {
  font-size: 24px;
  cursor: pointer;
  user-select: none;

  /* UI look */
  padding: 0px 0px;
  border-radius: 8px;
  transition: transform 0.2s ease, background-color 0.2s ease;
      outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* Focus / click highlight remove */
.account:focus {
  outline: none;
}
.account:focus-visible {
  outline: none;
}

/* Hover effect */
.account:hover {
  background-color: rgba(255,255,255,0.1);
}

/* Click / active animation */
.account:active {
  transform: scale(0.80);         /* small shrink */
  background-color: rgba(255,255,255,0.2);
}


/* Overlay */
.overlay {
  position:fixed;
  top:0;
  left:0; 
  width:100%; 
  height:100%;
  background: rgba(0,0,0,0.3); backdrop-filter: blur(6px);
  opacity:0;
  pointer-events:none; transition:opacity 0.3s ease; z-index:100;
}
    
.overlay.show { 
    opacity:1;
    pointer-events:auto; 
}

/* Drawer */
.drawer {
  position:fixed;
  bottom:-0px; 
  left:50%;
  transform:translateX(-50%) translateY(100%);
  width:100%; 
  max-width:95%;
  max-height:80vh;
  background: #000000; 
  border-top-left-radius:16px;
  border-top-right-radius:16px;
  box-shadow:0 -2px 20px rgba(0,0,0,0.3);
  transition:transform 0.3s ease;
  padding:16px 16px 40px 16px; 
  overflow:auto;
  z-index:101;
}
    
.drawer.open { 
    transform:translateX(-50%) translateY(0); 
}

/* Drawer handle */
.drawer-handle {
    width:40px;
    height:2px; 
    background:#ccc;
    border-radius:2px;
    margin:0 auto 12px auto;
}

/* Drawer Close button (X) */
.drawer .close-btn { 
    position:absolute;
    top:8px; 
    right:12px; 
    font-size:30px; 
    cursor:pointer; 
    color:#333; 

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.drawer .close-btn:hover {
    filter: brightness(1.1);
}

.drawer .close-btn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.drawer .close-btn:focus {
    outline: none;
    box-shadow: none;
}

/* ============================================================================ */  
    
/* tile cutter and download button center vertical style css */ 
.controldown {  
  display: flex;  
  flex-direction: column;     /* buttons vertical stack */  
  align-items: center;        /* center horizontally */   
  gap: 12px;  
  height: nomal;              /* full screen height */  
}  

.controldown button {  
  display: flex;              /* flexbox inside button */  
  align-items: center;        /* vertical center text */  
  padding: 10px 16px;  
  border-radius: 8px;  
  border: none;  
  cursor: pointer;  
  font-size: 16px;  
  font-weight: 500;  
  width: 80%;               /* same width */  
  text-align: center;         /* fallback center */  
  justify-content: center; 
}
    
    
/* ============================= ALL BUTTON LAYOUT CSS ========================= */    
/*file select bitton css*/
.file-btn {
    background: linear-gradient(135deg, #ff0000, #ffff00, #ff0000);
    color: #03201a;
    margin-bottom: 10px;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    display: inline-block;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);


    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}
    
.file-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.3);
}
.file-btn:active {
    transform: translateY(0.80);
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}
    
/* load & start button css */
.btn.primary{
    background: linear-gradient(90deg, #0f2b3a, #ff0000);
    border:0px solid #000000;
    color:var(--text);
    width:40%;
    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.btn.primary:hover {
    filter: brightness(1.1);
}

.btn.primary:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.btn.primary:focus {
    outline: none;
    box-shadow: none;
}

/* reset button css */
.resetbtn {
    background: linear-gradient(90deg, #ff0000, #0f2b3a);
    border: 1px solid #203040;
    width: 40%;
    color: var(--text);
    margin-left: 5px;
    padding: 8px 10px;
    border-radius: 10px;
    cursor: pointer;

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.resetbtn:hover {
    filter: brightness(1.1);
}

.resetbtn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.resetbtn:focus {
    outline: none;
    box-shadow: none;
}
    
/* crop button css */
.cropbtn{
    background: linear-gradient(360deg, #0f2b3a, #ff0000);
    border:1px solid #203040;
    color:var(--text);
    margin-left:5px;
    padding:8px 10px;
    border-radius:10px;
    cursor:pointer
    
    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.cropbtn:hover {
    filter: brightness(1.1);
}

.cropbtn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.cropbtn:focus {
    outline: none;
    box-shadow: none;
}
    
/* download button css */
.downbtn{
    background: linear-gradient(180deg, #0f2b3a, #ff0000);
    border:1px solid #203040;
    color:var(--text);
    margin-left:5px;
    padding:8px 10px;
    border-radius:10px;
    cursor:pointer

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.downbtn:hover {
    filter: brightness(1.1);
}

.downbtn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.downbtn:focus {
    outline: none;
    box-shadow: none;
}
    
/* Back to gird button css */    
.aback-btn {
    background: linear-gradient(135deg, #0f2b3a, #ff0000);
    color: var(--text);
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.aback-btn:hover {
    filter: brightness(1.1);
}

.aback-btn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.aback-btn:focus {
    outline: none;
    box-shadow: none;
}
    
/* dialog tile download buton css */
.control-btn {
    background: linear-gradient(135deg, #ff0000, #ffff00, #ff0000);
    color: #03201a;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.control-btn:hover {
    filter: brightness(1.1);
}

.control-btn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.control-btn:focus {
    outline: none;
    box-shadow: none;
}
    
/* dialog close button css */
.back-btn {
    background: linear-gradient(135deg, #ff0000, #0f2b3a);
    color: var(--text);
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;

    outline: none;               
    box-shadow: none;            
    -webkit-tap-highlight-color: transparent; 
    user-select: none;            
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    transition: all 0.15s ease-in-out;
}

.back-btn:hover {
    filter: brightness(1.1);
}

.back-tbtn:active {
    transform: scale(0.80);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.back-btn:focus {
    outline: none;
    box-shadow: none;
}
/* ==================================================================== */
    
/* ==================== ALL ANIMATION CSS DOCS ======================= */
    
  .btnset {
    display: none; /* default hidden completely */
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }

  /* visible state */
  .btnset.show {
    display: flex;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }
    
/* fade-in animation */
.fade-in {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInTile 0.5s forwards ease-out;
}

@keyframes fadeInTile {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
    
/* zoom out animation */   
@keyframes zoomOutAnim {
  0% {
    opacity: 1;
    transform: scale(1) translateY(0);
    filter: blur(0);
  }
  100% {
    opacity: 0;
    transform: scale(1.0) translateY(20px);
    filter: blur(6px);
  }
}

.fade-out {
  animation: zoomOutAnim 0.4s forwards ease-in;
}

    
/* Tile reveal animation */
@keyframes tileReveal {
  0% {
    opacity: 0;
    transform: scale(0.85) translateY(20px);
    filter: blur(10px);
    visibility: visible;
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
    filter: blur(0);
    visibility: visible;
  }
}

/* Tile base state */
.tile {
  opacity: 0;
  transform: translateY(30px) scale(0.85);  /* 👈 fade up + zoom out */
  transition: opacity 0.4s ease, transform 0.4s ease;
}

/* Tile show state */
.tile.show {
  opacity: 1;
  transform: translateY(0) scale(1);        /* 👈 fade in + zoom in */
}
    
/* Single preview base */
#modalSingleImg {
  opacity: 0;
  transform: translateX(50px); /* slide from right */
  transition: opacity 0.5s ease, transform 0.5s ease;
}

/* Single preview active */
#modalSingleImg.preview-animate {
  opacity: 1;
  transform: translateX(0); /* final position */
}
    
/* ================================================================ */
    
/* ======================== cropper edit ======================= */
.cropper-view-box {
    outline: 3px solid #ff0000; /* green border */
    outline-offset: -1px;
}
    
.cropper-bg {
    background-color: rgba(0,0,0,0.6) !important;
}
    
.cropper-point {
    background-color: #ff0000;
    width: 10px;
    height: 10px;
}
    
.cropper-dashed,
.cropper-center {
    display: none !important; /* remove dashed lines + center point */
}
    
cropper = new Cropper(preview, {
    viewMode: 1,
    dragMode: 'move',
    autoCropArea: 0.9,
    aspectRatio: 3 / 2,
    background: false,  
    guides: false,    
    center: true,      
    highlight: false,
    movable: true,
    zoomable: true,
    rotatable: false,
    scalable: false
}
    
/* =================================================== */
    
</style>
</head>
<body>
    <!-- 🔹 Background video -->
<video autoplay muted loop playsinline class="bg-video">
  <source src="video.mp4" type="video/mp4">
</video>
 <div class="toolbar">
  <div class="menu" id="menuIcon">☰</div>
  <div class="title">DEVELOPER LEAD x SASI</div>
  <div class="account">👤</div>
</div>

<div class="overlay" id="overlay"></div>

<div class="drawer" id="bottomDrawer">
  <div class="drawer-handle"></div>
  <div class="close-btn" id="closeDrawer">×</div>
  <h3>Bottom Drawer</h3>
  <p>Toolbar menu icon opens this drawer. Add your content here.</p>
</div>
    <div class="background">
<h1>WhatsApp Product: 6 Square Tiles (3×2) — Grid Preview</h1>
<div class="top">
  <input id="file" type="file" accept="image/*" style="display:none;" />
  <label for="file" class="btn file-btn">📂 Choose Image</label>
</div>
        
<center><div id="details"></div></center>
<center>
  <div class="btnset hidden">
    <button id="start" class="btn primary" disabled>Load & Start</button>
    <button id="reset" class="resetbtn" disabled>Reset</button>
  </div>
</center>
        
  <div style="flex:1"></div>
    
<center>
  <div class="note" style="display:inline-block; margin: 10px 0; font-size: 10px;">
    Crop box locked to <strong>3:2</strong> — result will be 6 squares (3×2).
  </div>
</center>

<div class="stage">
  <div id="imgWrap" style="display:flex;justify-content:center;align-items:center;position:relative;">
    <img id="preview" alt="Load an image first" />
  </div>
</div>

</div>
    <div class="controldown">
    <button id="cropSplit" class="cropbtn" disabled>Make 6 Tiles</button>
    <button id="downloadAll" class="downbtn" disabled>Download All</button>
</div>

<div id="tiles" class="tiles"></div>

<div id="tilePreviewModal" role="dialog" aria-hidden="true">
  <div class="preview-shell">
    <div class="preview-top">
      <div class="preview-title">Tile Pack Preview</div>
      <div class="preview-actions">
        <button id="modalBack" class="back-btn" style="display:none">← Back to grid</button>
        <button id="modalDownload" class="control-btn" style="display:none">Download</button>
        <button id="modalClose" class="back-btn">Close</button>
      </div>
    </div>
    <div id="modalGrid" class="preview-grid" aria-hidden="false"></div>
    <div id="modalSingle" class="preview-single" aria-hidden="true">
      <img id="modalSingleImg" src="" alt="Tile" />
    </div>
    <div class="hint">Grid view: click a tile to open zoomable preview. In single view: wheel/pinch to zoom, drag to move, double-click to reset.</div>
  </div>
</div>
</div>

<script src="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.js"></script>
<script>
// JS same as your last code (cropper, 6 tiles, modal, zoom/drag)
const fileEl=document.getElementById('file');
const startBtn=document.getElementById('start');
const resetBtn=document.getElementById('reset');
const preview=document.getElementById('preview');
const cropSplitBtn=document.getElementById('cropSplit');
const downloadAllBtn=document.getElementById('downloadAll');
const tilesWrap=document.getElementById('tiles');
const modal=document.getElementById('tilePreviewModal');
const modalGrid=document.getElementById('modalGrid');
const modalSingle=document.getElementById('modalSingle');
const modalSingleImg=document.getElementById('modalSingleImg');
const modalClose=document.getElementById('modalClose');
const modalBack=document.getElementById('modalBack');
const modalDownload=document.getElementById('modalDownload');
const btnset = document.querySelector(".btnset");
const fileInput = document.getElementById("file");
const details = document.getElementById("details");
    
fileEl.addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;

    // show buttons container
    btnset.classList.add("show");

    // enable start
    startBtn.disabled = false;
    resetBtn.disabled = true;
  });
    
/* =============================================== */

  fileInput.addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;
      
    // Create base table with title
let table = `
  <table>
    <caption style="caption-side: top; font-weight: bold; font-size: 16px; margin-bottom: 8px;">
      Image Details
    </caption>
    <tr><th>Property</th><th>Value</th></tr>
    <tr><td>Name</td><td>${file.name}</td></tr>
    <tr><td>Size</td><td>${(file.size / 1024).toFixed(1)} KB</td></tr>
    <tr><td>Type</td><td>${file.type}</td></tr>
`;

    // Load image to get dimensions
    const img = new Image();
    img.onload = () => {
      table += `<tr><td>Dimensions</td><td>${img.width} × ${img.height}px</td></tr>`;
      table += `</table>`;
      details.innerHTML = table;

      // 👇 Trigger animation
      const tbl = details.querySelector("table");
      setTimeout(() => tbl.classList.add("show"), 50);
    };
    img.src = URL.createObjectURL(file);
  });
    
/* =============================== image selector staring ================================ */

let cropper=null;
let currentFileName='image';
let generatedTiles=[];

fileEl.addEventListener('change',()=>{ startBtn.disabled=!fileEl.files.length; });

startBtn.addEventListener('click', () => {
    const f = fileEl.files && fileEl.files[0];
    if (!f) return;

    currentFileName = (f.name || 'image').replace(/\.[^.]+$/, '');
    const sizeKB = (f.size / 1024).toFixed(1);

    // Resize image before cropper
    const reader = new FileReader();
    reader.onload = function (event) {
        const imgRes = new Image();
        imgRes.onload = function () {
            const TARGET_WIDTH = 1024;
            const scale = TARGET_WIDTH / imgRes.width;
            const width = TARGET_WIDTH;
            const height = imgRes.height * scale;

            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(imgRes, 0, 0, width, height);

            const resizedUrl = canvas.toDataURL('image/jpeg', 0.9);
            preview.src = resizedUrl;
            
preview.onload = () => {
    // reset animation
    preview.classList.remove('preview-animate');
    void preview.offsetWidth; // force reflow
    preview.classList.add('preview-animate'); // now visible + animate

    // cropper init
    if (cropper) cropper.destroy();
    cropper = new Cropper(preview, {
        viewMode: 3,
        dragMode: 'move',
        autoCropArea: 0.9,
        aspectRatio: 3 / 2,
        background: false,
        guides: false,
        center: true,
        highlight: false,
        movable: true,
        zoomable: true,
        rotatable: false,
        scalable: false,
        zoom(event) {
            const imageData = cropper.getImageData();
            const minRatio = Math.max(
                preview.clientWidth / imageData.naturalWidth,
                preview.clientHeight / imageData.naturalHeight
            );
            if (event.detail.ratio < minRatio) {
                event.preventDefault();
                cropper.zoomTo(minRatio);
            }
        }
    });

    startBtn.disabled = true;
    resetBtn.disabled = false;
    cropSplitBtn.disabled = false;
};
        };
        imgRes.src = event.target.result;
    };
    reader.readAsDataURL(f);
});

// --- Reset button --- //
resetBtn.addEventListener('click', () => {
    if (cropper) cropper.reset();
    tilesWrap.innerHTML = '';
    generatedTiles = [];
    downloadAllBtn.disabled = true;
    modalGrid.innerHTML = '';
});
    
// bottom drawer script
    const drawer = document.getElementById('bottomDrawer');
const overlay = document.getElementById('overlay');
const menuIcon = document.getElementById('menuIcon');
const closeBtn = document.getElementById('closeDrawer');

function openDrawer() {
  drawer.classList.add('open');
  overlay.classList.add('show');
}
function closeDrawer() {
  drawer.classList.remove('open');
  overlay.classList.remove('show');
}

menuIcon.addEventListener('click', openDrawer);
closeBtn.addEventListener('click', closeDrawer);
overlay.addEventListener('click', closeDrawer);

resetBtn.addEventListener('click',()=>{
  if(cropper) cropper.reset();
  tilesWrap.innerHTML=''; generatedTiles=[]; downloadAllBtn.disabled=true; modalGrid.innerHTML='';
});

const EXTRA = 8; // pixels

/* ========================== Tile Insets ========================== */
function getInsetsFor(row, col){
  // tile numbers:
  // 1 2 3
  // 4 5 6
  const n = row*3 + col + 1;
  let L=0,R=0,T=0,B=0;
  if(n===1){ R=EXTRA; B=EXTRA; }
  if(n===2){ L=EXTRA; R=EXTRA; B=EXTRA; }
  if(n===3){ L=EXTRA; B=EXTRA; }
  if(n===4){ R=EXTRA; T=EXTRA; }
  if(n===5){ L=EXTRA; R=EXTRA; T=EXTRA; }
  if(n===6){ L=EXTRA; T=EXTRA; }
  return {L,R,T,B};
}

/* ========================== Split & Generate Tiles ========================== */
cropSplitBtn.addEventListener('click', () => {
    if (!cropper) return;

    tilesWrap.innerHTML = '';
    modalGrid.innerHTML = '';
    generatedTiles = [];

    // 1. Get cropped canvas from Cropper
    const croppedCanvas = cropper.getCroppedCanvas();
    const TARGET_WIDTH = 1024;

    // 2. Scale cropped canvas to 1024px width (if needed)
    let scaledCanvas = document.createElement('canvas');
    let scale = TARGET_WIDTH / croppedCanvas.width;
    scaledCanvas.width = TARGET_WIDTH;
    scaledCanvas.height = croppedCanvas.height * scale;

    const ctx = scaledCanvas.getContext('2d');
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(croppedCanvas, 0, 0, scaledCanvas.width, scaledCanvas.height);

    // 3. Calculate tile sizes for a 3x2 grid
    const sw = scaledCanvas.width;
    const sh = scaledCanvas.height;
    const tileWidth = Math.floor(sw / 3);  // 3 columns
    const tileHeight = Math.floor(sh / 2); // 2 rows

    for (let row = 0; row < 2; row++) {
        for (let col = 0; col < 3; col++) {
            const baseX = col * tileWidth;
            const baseY = row * tileHeight;

            const { L, R, T, B } = getInsetsFor(row, col);
            const sX = baseX + L, sY = baseY + T;
            const sW = tileWidth - (L + R), sH = tileHeight - (T + B);

            const canvas = document.createElement('canvas');
            canvas.width = tileWidth;
            canvas.height = tileHeight;

            const ctxTile = canvas.getContext('2d');
            ctxTile.imageSmoothingEnabled = true;
            ctxTile.imageSmoothingQuality = 'high';

            ctxTile.drawImage(
                scaledCanvas,
                sX, sY, sW, sH,  // source rectangle
                0, 0, tileWidth, tileHeight // destination rectangle
            );

            const url = canvas.toDataURL('image/png');
            const name = `${currentFileName}_tile_${row}_${col}.png`;
            generatedTiles.push({ url, name });

// Show tile preview
const wrap = document.createElement('div');
wrap.className = 'tile fade-in'; // ✅ fade-in animation

const img = document.createElement('img');
img.src = url;
img.alt = name;
img.style.width = "100%";   // ✅ image full width
img.style.height = "auto";  // ✅ keep aspect ratio
wrap.appendChild(img);

const a = document.createElement('a');
a.href = url;
a.download = name;
a.className = 'download-link';
a.textContent = 'Download';
wrap.appendChild(a);

tilesWrap.appendChild(wrap);

// small delay for sequential effect
wrap.style.animationDelay = `${(row * 3 + col) * 0.1}s`;
        }
    }

    buildModalGrid();
    downloadAllBtn.disabled = false;
});

/* ========================== Download All ========================== */
downloadAllBtn.addEventListener('click',()=>{
  if(!generatedTiles.length) return;
  let i=0;
  function next(){
    if(i>=generatedTiles.length) return;
    const a=document.createElement('a'); a.href=generatedTiles[i].url; a.download=generatedTiles[i].name;
    document.body.appendChild(a); a.click(); a.remove();
    i++; setTimeout(next,250);
  }
  next();
});

/* ========================== Modal Grid ========================== */
function buildModalGrid() {
  modalGrid.innerHTML = '';

generatedTiles.forEach((t, idx) => {
  const wrap = document.createElement('div');
  wrap.className = 'tile'; // default hidden via opacity

  const img = document.createElement('img');
  img.src = t.url;
  img.alt = t.name;
  wrap.appendChild(img);

  wrap.addEventListener('click', () => openSingleView(idx));

  modalGrid.appendChild(wrap);

  setTimeout(() => {
    wrap.classList.add('show'); // fade + slide + click enable
  }, idx * 150);
});

  openModalGrid();
}

function openModalGrid() {
  modal.style.display = 'flex';

  // trigger overlay fade + blur
  requestAnimationFrame(() => {
    modal.classList.add('show');
  });

  modalGrid.style.display = 'grid';
  modalGrid.setAttribute('aria-hidden', 'false');
  modalSingle.style.display = 'none';
  modalSingle.setAttribute('aria-hidden', 'true');
  modalBack.style.display = 'none';
  modalDownload.style.display = 'none';
  modalClose.style.display = 'inline-block';
}

function closeModal() {
  // remove show class for fade out
  modal.classList.remove('show');

  // optional: staggered hide tiles
  const tiles = modalGrid.querySelectorAll('.tile');
  tiles.forEach((tile, idx) => {
    setTimeout(() => {
      tile.classList.remove('preview-animate');
    }, idx * 50);
  });

  // wait overlay transition then hide completely
  setTimeout(() => {
    modal.style.display = 'none';
    modalGrid.innerHTML = '';
    modalSingleImg.src = '';
    modalSingleImg.classList.remove('preview-animate');
  }, 500); // match overlay transition
}

/* ========================== Open Modal Grid ========================== */
function openSingleView(index) {
    const tile = generatedTiles[index];
    if (!tile) return;

    modal.style.display = 'flex';

    modalGrid.style.display = 'none';
    modalGrid.setAttribute('aria-hidden', 'true');

    modalSingle.style.display = 'flex';
    modalSingle.setAttribute('aria-hidden', 'false');

    modalBack.style.display = 'inline-block';   // Show Back button
    modalDownload.style.display = 'inline-block';
    modalClose.style.display = 'inline-block';

    // Reset animation
    modalSingleImg.classList.remove('preview-animate');
    void modalSingleImg.offsetWidth; // trigger reflow

    modalSingleImg.src = tile.url;
    modalSingleImg.classList.add('preview-animate');

    // Download handler
    modalDownload.onclick = () => {
        const a = document.createElement('a');
        a.href = tile.url;
        a.download = tile.name;
        document.body.appendChild(a);
        a.click();
        a.remove();
    };

    resetSingleTransform();
}

/* ========================== Single Tile Preview ========================== */
function openSingleView(index) {
    const tile = generatedTiles[index];
    if (!tile) return;

    modal.style.display = 'flex';
    modalGrid.style.display = 'none';
    modalGrid.setAttribute('aria-hidden', 'true');
    modalSingle.style.display = 'flex';
    modalSingle.setAttribute('aria-hidden', 'false');

    modalBack.style.display = 'inline-block';
    modalDownload.style.display = 'inline-block';
    modalClose.style.display = 'inline-block';

    // Reset animation
    modalSingleImg.classList.remove('preview-animate');
    void modalSingleImg.offsetWidth; // trigger reflow

    // Set new image
    modalSingleImg.src = tile.url;

    // Small delay to allow DOM update before animation
    setTimeout(() => {
      modalSingleImg.classList.add('preview-animate');
    }, 50);

    // Download handler
    modalDownload.onclick = () => {
        const a = document.createElement('a');
        a.href = tile.url;
        a.download = tile.name;
        document.body.appendChild(a);
        a.click();
        a.remove();
    };

    resetSingleTransform();
}

/* ========================== Close Modal ========================== */
function closeModal() {
  // active view එක detect කරන්න (grid හෝ single)
  const activeView =
    modalSingle.style.display === 'flex' ? modalSingle : modalGrid;

  // zoom-out effect add කරන්න
  activeView.classList.add('fade-out');

  // modal hide කරන්න animation ඉවර උන පස්සේ
  activeView.addEventListener(
    'animationend',
    () => {
      modal.style.display = 'none';

      // Reset content
      modalGrid.innerHTML = modalGrid.innerHTML;
      modalSingleImg.src = '';
      modalSingleImg.classList.remove('preview-animate');
      activeView.classList.remove('fade-out'); // reset class
    },
    { once: true } // එකම එකసారి trigger වෙන්න
  );
}

/* ========================== Event Listeners ========================== */
modalClose.addEventListener('click', closeModal);
modalBack.addEventListener('click', () => {
    // Animate single view out to right
    modalSingleImg.classList.remove('preview-animate'); // reset fade-in
    modalSingleImg.style.transform = 'translateX(50px)';  // slide out
    modalSingleImg.style.opacity = '0';                   // fade out

    // පොඩ්ඩක් delay දීලා grid open කරන්න
    setTimeout(() => {
        openModalGrid();

        // reset for next time
        modalSingleImg.style.transform = '';
        modalSingleImg.style.opacity = '';
    }, 300); // 300ms = CSS transition duration
});
modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
});

/* ========================== singal image zoom and drag =============== */
modalSingleImg.addEventListener('dblclick',()=>{ resetSingleTransform(); });

/* ========================== Touch Support ========================== */
modalSingleImg.addEventListener('touchstart',e=>{
  if(e.touches.length===2){
    const a=e.touches[0],b=e.touches[1];
    s.lastTouchDist=Math.hypot(b.clientX-a.clientX,b.clientY-a.clientY);
  } else if(e.touches.length===1){
    const t=e.touches[0]; s.lastTouchPos={x:t.clientX-s.tx,y:t.clientY-s.ty};
  }
},{passive:false});

modalSingleImg.addEventListener('touchmove',e=>{
  if(e.touches.length===2 && s.lastTouchDist){
    const a=e.touches[0],b=e.touches[1];
    const d=Math.hypot(b.clientX-a.clientX,b.clientY-a.clientY);
    const factor=d/s.lastTouchDist;
    zoomSingleAt(factor,(a.clientX+b.clientX)/2-modalSingleImg.getBoundingClientRect().left,(a.clientY+b.clientY)/2-modalSingleImg.getBoundingClientRect().top);
    s.lastTouchDist=d; e.preventDefault();
  } else if(e.touches.length===1 && s.lastTouchPos){
    const t=e.touches[0]; s.tx=t.clientX-s.lastTouchPos.x; s.ty=t.clientY-s.lastTouchPos.y; applySingleTransform();
  }
},{passive:false});

modalSingleImg.addEventListener('touchend',e=>{
  if(e.touches.length<2) s.lastTouchDist=null;
  if(e.touches.length===0) s.lastTouchPos=null;
});

/* ========================== Keyboard Support ========================== */
window.addEventListener('keydown',e=>{
  if(e.key==='Escape' && modal.style.display==='flex') closeModal();
  if((e.key==='Backspace'||e.key==='ArrowLeft') && modalSingle.style.display!=='none') openModalGrid();
});

</script>
    
  <div class="bottom-toolbar">
     ʟᴇᴀᴅ ʜᴜʙ ᴄᴏᴍᴍᴜɴɪᴛʏ ™
  </div>

</body>
</html>
